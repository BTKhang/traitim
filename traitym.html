<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Gửi emiu</title>

    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <style>
        /* ... (Phần CSS giữ nguyên) ... */
        body { margin: 0; background: #000; overflow: hidden; }

        /* CANVAS nằm phía sau */
        canvas {
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            display: none;
            z-index: 1;
        }

        /* BOX MẬT KHẨU */
        #loginBox {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(255,255,255,0.1);
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 0 20px rgba(255,0,150,0.7);
            backdrop-filter: blur(10px);
            text-align: center;
            z-index: 9999;
        }

        #loginBox input {
            padding: 10px 15px;
            width: 220px;
            border-radius: 8px;
            border: none;
            outline: none;
            font-size: 18px;
            text-align: center;
        }

        #loginBox button {
            margin-top: 15px;
            padding: 10px 25px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            background: #ff4fa6;
            color: white;
            font-size: 18px;
            font-weight: bold;
        }

        #wrongPass {
            margin-top: 10px;
            color: #ff8080;
            font-size: 17px;
            display: none;
        }

        /* =================== MOBILE FIX ====================== */
        @media (max-width: 600px) {
            #loginBox { width: 80%; padding: 20px; }
            #loginBox input { width: 90%; font-size: 16px; }
            #loginBox button { font-size: 16px; }
            body { overflow: hidden; }
        }
    </style>

    <link href="https://fonts.googleapis.com/css2?family=Great+Vibes&display=swap" rel="stylesheet">
</head>
<body>

<div id="loginBox">
    <h2 style="color:white; font-family: 'Great Vibes'; font-size:42px;">
        eiu nhập mật khẩu đi ạ
    </h2>
    <input type="password" id="passInput" placeholder="••••••">
    <br>
    <button onclick="checkPass()">OK</button>
    <div id="wrongPass">Sai mật khẩu!</div>
</div>

<canvas id="heart"></canvas>

<audio id="backgroundMusic" loop preload="auto">
    <source src="background_music.mp3" type="audio/mpeg">
    Trình duyệt của bạn không hỗ trợ thẻ audio.
</audio>
<script>
const PASSWORD = "161227";

function checkPass() {
    const input = document.getElementById("passInput").value;
    const wrong = document.getElementById("wrongPass");
    const music = document.getElementById("backgroundMusic"); // Lấy thẻ audio

    if (input === PASSWORD) {
        document.getElementById("loginBox").style.display = "none";
        document.getElementById("heart").style.display = "block";
        
        // ******************************************************
        // PHÁT NHẠC
        music.play().catch(error => {
             // Thường xảy ra nếu tương tác người dùng chưa đủ rõ ràng
             console.log("Lỗi phát nhạc:", error);
        });
        // ******************************************************
        
        init();
    } else wrong.style.display = "block";
}

/* ===========================================
    LOAD ẢNH
=========================================== */
const smallImgs = [];
for (let i = 1; i <= 10; i++) {
    const img = new Image();
    img.src = "small" + i + ".png"; 
    smallImgs.push(img);
}

let bigImg = smallImgs[0];
let bigReady = false;

let loadedCount = 0;
smallImgs.forEach(img => {
    img.onload = () => {
        loadedCount++;
        if (loadedCount === smallImgs.length) bigReady = true;
    };
});

setInterval(() => {
    bigImg = smallImgs[Math.floor(Math.random() * smallImgs.length)];
}, 2000);

/* ===========================================
    ANIMATION
=========================================== */

window.requestAnimationFrame =
    window.requestAnimationFrame ||
    function (cb) { return setTimeout(cb, 33); };

let loaded = false;

function init() {

    if (loaded) return;
    loaded = true;

    const canvas = document.getElementById("heart");
    const ctx = canvas.getContext("2d");

    // Xử lý Device Pixel Ratio (Fix vỡ ảnh trên iPhone/Mobile)
    const dpr = window.devicePixelRatio || 1;
    
    let W = innerWidth;
    let H = innerHeight;
    
    // Đặt kích thước vật lý của canvas (độ phân giải thực)
    canvas.width = W * dpr;
    canvas.height = H * dpr;
    
    // Đặt kích thước hiển thị của canvas (CSS)
    canvas.style.width = W + 'px';
    canvas.style.height = H + 'px';
    
    // Tăng tỷ lệ cho mọi thao tác vẽ để khớp với độ phân giải vật lý
    ctx.scale(dpr, dpr);

    window.onresize = () => {
        // Cập nhật lại kích thước khi resize
        W = innerWidth;
        H = innerHeight;
        
        canvas.width = W * dpr;
        canvas.height = H * dpr;
        canvas.style.width = W + 'px';
        canvas.style.height = H + 'px';
        
        ctx.scale(dpr, dpr);
    };

    /* ============ HEART PATH ============== */
    function heart(rad) {
        return [
            Math.pow(Math.sin(rad), 3),
            -(15 * Math.cos(rad) - 5 * Math.cos(2 * rad) - 2 * Math.cos(3 * rad) - Math.cos(4 * rad))
        ];
    }

    function scale(p, sx, sy, dx, dy) {
        return [dx + p[0] * sx, dy + p[1] * sy];
    }

    // Giữ nguyên scaleFactor như code gốc bạn cung cấp
    let pts = [];
    const scaleFactor = W < 600 ? 0.7 : 1; 

    for (let r = 0; r < Math.PI * 2; r += 0.1)
        pts.push(scale(heart(r), 210 * scaleFactor, 15 * scaleFactor, 0, 0));

    for (let r = 0; r < Math.PI * 2; r += 0.1)
        pts.push(scale(heart(r), 150 * scaleFactor, 10 * scaleFactor, 0, 0));

    for (let r = 0; r < Math.PI * 2; r += 0.1)
        pts.push(scale(heart(r), 90 * scaleFactor, 6 * scaleFactor, 0, 0));

    let N = pts.length;
    let target = [];

    function pulse(kx, ky) {
        for (let i = 0; i < N; i++) {
            target[i] = [
                pts[i][0] * kx + W / 2, 
                pts[i][1] * ky + H / 2
            ];
        }
    }

    /* ============ PARTICLES ============== */
    let particles = [];
    // ... (Phần logic hạt giữ nguyên)

    for (let i = 0; i < N; i++) {
        let x = Math.random() * W;
        let y = Math.random() * H;

        let t = [];
        for (let k = 0; k < 40; k++) t.push({ x: x, y: y });

        particles[i] = {
            vx: 0, vy: 0,
            speed: Math.random() * 1 + 5,
            q: Math.floor(Math.random() * N),
            D: Math.random() < 0.5 ? -1 : 1,
            force: 0.7 + Math.random() * 0.3,
            trace: t,
            img: smallImgs[Math.floor(Math.random() * smallImgs.length)]
        };
    }

    function heartPath(ctx, cx, cy, size) {
        ctx.beginPath();
        const steps = 200;
        for (let i = 0; i <= steps; i++) {
            let t = (Math.PI * 2) * (i / steps);
            let x = 16 * Math.pow(Math.sin(t), 3);
            let y = -(13 * Math.cos(t) - 5 * Math.cos(2 * t) - 2 * Math.cos(3 * t) - Math.cos(4 * t));

            x = cx + x * (size / 17);
            y = cy + y * (size / 17);

            if (i === 0) ctx.moveTo(x, y);
            else ctx.lineTo(x, y);
        }
        ctx.closePath();
    }

    let opacityBig = 0;
    let time = 0;

    /* ============ MAIN LOOP ============== */
    function loop() {

        time += 0.01;
        let K = (1 - Math.cos(time)) * 0.5;
        pulse(K, K);

        ctx.fillStyle = "rgba(0,0,0,0.18)";
        ctx.fillRect(0, 0, W, H);

        /* ----- PARTICLES (Giữ nguyên) ----- */
        for (let i = 0; i < N; i++) {
            let p = particles[i];
            let tg = target[p.q];

            let dx = p.trace[0].x - tg[0];
            let dy = p.trace[0].y - tg[1];
            let dist = Math.sqrt(dx * dx + dy * dy) + 0.001;

            if (dist < 20) {
                if (Math.random() > 0.95) p.q = Math.floor(Math.random() * N);
                else {
                    if (Math.random() > 0.99) p.D *= -1;
                    p.q = (p.q + p.D + N) % N;
                }
            }

            p.vx += -dx / dist * p.speed;
            p.vy += -dy / dist * p.speed;

            p.trace[0].x += p.vx;
            p.trace[0].y += p.vy;

            p.vx *= p.force;
            p.vy *= p.force;

            for (let k = 1; k < p.trace.length; k++) {
                p.trace[k].x -= 0.4 * (p.trace[k].x - p.trace[0].x);
                p.trace[k].y -= 0.4 * (p.trace[k].y - p.trace[0].y);
            }

            for (let k = 0; k < p.trace.length; k++) {
                let t = p.trace[k];
                ctx.drawImage(p.img, t.x - 6, t.y - 6, 12, 12);
            }
        }

        /* ----- BIG HEART IMAGE ----- */
        if (bigReady) {
            if (opacityBig < 1) opacityBig += 0.02;

            ctx.save();
            ctx.globalAlpha = opacityBig;

            let beat = 1 + Math.sin(time * 2) * 0.1;
            // Giữ nguyên baseSize như code gốc bạn cung cấp
            let baseSize = Math.min(W, H) * 0.15; 
            let S = baseSize * beat;

            heartPath(ctx, W / 2, H / 2, S);
            ctx.clip();
            ctx.drawImage(bigImg, W / 2 - S, H / 2 - S, S * 2, S * 2);

            ctx.restore();
        }

        /* ---------------- TEXT ---------------- */
        ctx.save();

        /* ====== TÊN ======= */
        ctx.font = (W < 600 ? "36px 'Great Vibes'" : "48px 'Great Vibes'");
        ctx.fillStyle = "white";
        ctx.textAlign = "center";

        let glow = 10 + Math.sin(time * 3) * 6;
        ctx.shadowColor = "rgba(255,50,150,0.9)";
        ctx.shadowBlur = glow;

        // Giữ nguyên logic tính toán vị trí tên
        let nameY = H/2 + Math.min(W,H)*0.30; 
        ctx.fillText("Lê Thị Thu Hằng", W/2, nameY);

        /* ====== LỜI CHÚC ======= */
        ctx.font = (W < 600 ? "20px 'Great Vibes'" : "28px 'Great Vibes'");
        ctx.shadowBlur = 0;

        const messages = [
            "Chúc em luôn xinh đẹp và rạng rỡ như hôm nay ♥",
            "Chúc em lúc nào cũng tràn niềm vui và hạnh phúc.",
            "Mong hai ta trải qua bao khó khăn cũng luôn chọn bên nhau.",
            "Cùng ở bên nhau thật lâu nhé cô giáo nhỏ của a ạ ♥"
        ];

        const typingSpeed = 0.5;

        if (!window._lineIndex) window._lineIndex = 0;
        if (!window._typeIndex) window._typeIndex = 0;
        if (!window._typeTimer) window._typeTimer = 0;
        if (!window._lineDoneTimer) window._lineDoneTimer = 0;

        let currentLine = messages[window._lineIndex];
        window._typeTimer += 0.1;

        if (window._typeIndex >= currentLine.length) {
            window._lineDoneTimer += 0.1;

            if (window._lineDoneTimer > 15) {
                window._lineDoneTimer = 0;
                window._typeIndex = 0;
                window._lineIndex++;

                if (window._lineIndex >= messages.length)
                    window._lineIndex = 0;
            }

        } else {
            if (window._typeTimer > typingSpeed) {
                window._typeTimer = 0;
                window._typeIndex++;
            }
        }

        let visible = currentLine.substring(0, window._typeIndex);
        
        // Vị trí lời chúc nằm ngay dưới tên với khoảng cách nhỏ hơn
        ctx.fillText(visible, W/2, nameY + 55); 

        ctx.restore();

        requestAnimationFrame(loop);
    }

    loop();
}
</script>

</body>
</html>
